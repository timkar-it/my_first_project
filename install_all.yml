---

  - name: Zabbix-agent install Debian and RedHat
    hosts: all
    become: yes
    tasks:
    - block: #=============Debian=============           
      - name: Install a list of packages
        apt:
          name: "{{ packages }}"
          update_cache: yes
        vars:
          packages:
           - nginx
           - apache2
           - bind9
           - libapache2-mod-php
           - php7.4 
           - zabbix-agent  
      when: ansible_os_family == "Debian"


    - block: #=============RedHat==============
      - name: Add repository
        yum_repository:
         name: zabbix
         description: zabbix.repo
         baseurl: https://repo.zabbix.com/zabbix/5.4/rhel/8/x86_64/

      - name: Import a key from a url
        ansible.builtin.rpm_key:
         state: present
         key: https://repo.zabbix.com/RPM-GPG-KEY-ZABBIX 

      - name: GPGcheck 
        shell: echo 'gpgcheck=0' >> /etc/yum.repos.d/zabbix.repo   

      - name: install zabbix-agent RedHat
        yum: name=zabbix-agent state=latest
      when: ansible_os_family == "RedHat"


